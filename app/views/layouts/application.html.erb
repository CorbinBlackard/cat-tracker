<!DOCTYPE html>
<html>
	<head>
		<title><%= content_for(:title) || "Cat Tracker" %></title>
		<!-- FIXED: Added shrink-to-fit=no for Bootstrap -->
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="mobile-web-app-capable" content="yes">
		<%= csrf_meta_tags %>
		<%= csp_meta_tag %>

		<%= yield :head %>

		<%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
		<%#= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>

		<link rel="icon" href="/icon.png" type="image/png">
		<link rel="icon" href="/icon.svg" type="image/svg+xml">
		<link rel="apple-touch-icon" href="/icon.png">

		<%# Includes all stylesheet files in app/assets/stylesheets %>
		<%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
		<%= javascript_importmap_tags %>
		
		<!-- Bootstrap should be BEFORE your custom CSS -->
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	</head>

	<body class="body" style="padding-bottom: 70px;">
		<%= render partial: "/layouts/header" %>
		
		<main>
			<%= yield %>
		</main>
		
		<%= render partial: "/layouts/footer" %>
		
		<script>
			document.addEventListener("turbo:before-render", () => {
				localStorage.setItem("scrollPosition", window.scrollY);
			});

			document.addEventListener("turbo:render", () => {
				const scrollY = localStorage.getItem("scrollPosition");
				if (scrollY !== null) {
					// Create a thin progress bar at top
					const progressBar = document.createElement('div');
					progressBar.style.cssText = `
						position: fixed;
						top: 0;
						left: 0;
						width: 0%;
						height: 3px;
						background: linear-gradient(90deg, #3498db, #2ecc71);
						z-index: 9999;
						transition: width 0.5s ease;
					`;
					document.body.appendChild(progressBar);
					
					// Start progress bar
					requestAnimationFrame(() => {
						progressBar.style.width = '100%';
					});
					
					// Scroll and remove progress bar
					requestAnimationFrame(() => {
						window.scrollTo({
							top: parseInt(scrollY),
							behavior: 'smooth'
						});
						
						// Remove progress bar after animation
						setTimeout(() => {
							progressBar.style.opacity = '0';
							setTimeout(() => {
								if (progressBar.parentNode) {
									progressBar.parentNode.removeChild(progressBar);
								}
							}, 500);
						}, 600);
						
						localStorage.removeItem("scrollPosition");
					});
				}
			});
		</script>
	</body>
</html>
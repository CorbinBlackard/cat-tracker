<!DOCTYPE html>
<html>
	<head>
		<title><%= content_for(:title) || "Cat Tracker" %></title>
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="mobile-web-app-capable" content="yes">
		<%= csrf_meta_tags %>
		<%= csp_meta_tag %>

		<%= yield :head %>

		<link rel="icon" href="/icon.png" type="image/png">
		<link rel="icon" href="/icon.svg" type="image/svg+xml">
		<link rel="apple-touch-icon" href="/icon.png">

		<%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
		<%= javascript_importmap_tags %>
		
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	</head>

	<body class="body" style="padding-bottom: 70px;">
		<%= render partial: "/layouts/header" %>

		<main>
			<% if current_page?(root_path) %>
				<%# HOMEPAGE: Flex layout with sidebar %>
				<div class="homepage-container d-flex">
					<div class="sidebar-column">
						<div class="missing-cats-sidebar">
							<% missing_cats = Cat.missing_cats %>
							
							<h5 class="sidebar-title mb-3">
								‚ö†Ô∏è Missing Cats <span class="badge bg-warning"><%= missing_cats.count %></span>
							</h5>
							
							<% if missing_cats.any? %>
								<div class="list-group">
									<% missing_cats.each do |cat| %>
										<%= link_to cat, class: "list-group-item list-group-item-action py-2" do %>
											<strong><%= cat.name %></strong>
											<div class="text-muted small mt-1">
												Last seen: <%= time_ago_in_words(cat.last_seen) %> ago<br>
												Color: <%= cat.color %>
											</div>
										<% end %>
									<% end %>
								</div>
							<% else %>
								<div class="alert alert-success">
									üéâ All cats accounted for!
								</div>
							<% end %>
						</div>
					</div>
					
					<div class="main-content-column">
						<%= yield %>
					</div>
				</div>
			<% else %>
				<%# OTHER PAGES: Normal container %>
				<div class="container">
					<%= yield %>
				</div>
			<% end %>
		</main>
		
		<%= render partial: "/layouts/footer" %>
		
		<script>
			document.addEventListener("turbo:before-render", () => {
				localStorage.setItem("scrollPosition", window.scrollY);
			});

			document.addEventListener("turbo:render", () => {
				const scrollY = localStorage.getItem("scrollPosition");
				if (scrollY !== null) {
					window.scrollTo({
						top: parseInt(scrollY),
						behavior: 'smooth'
					});
					localStorage.removeItem("scrollPosition");
				}
			});
		</script>
	</body>
</html>